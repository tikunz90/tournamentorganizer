{% extends "layouts/base.html" %}

{% block title %} Structure {% endblock title %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

{% include "beachhandball/templates/_modal.html" %}

<h2>Structure Setup - 
  <small class="description">create Structure with Tournament Stages and States...</small>
</h2>
<div class="row">
  <div class="col-md-12 ml-auto mr-auto">
    <div class="page-categories">
      <div class="row">
        <div class="col-lg-3 col-md-3 col-sm-3 offset-4">
            <h3 class="title text-center">Stage Setup</h3>
          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 align-self-center">
            <div class="dropdown">
              <button class="dropdown-toggle btn btn-default btn-round btn-block" type="button" id="multiDropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="material-icons">settings</i>
              </button>
              <div class="dropdown-menu" aria-labelledby="multiDropdownMenu">
                <a class="dropdown-item dropdown-toggle" href=""><i class="material-icons">line_style</i> Stage</a>
                <div class="dropdown-menu" id="Stage-Menu">
                  <a id="create-stage-sync" class="dropdown-item">
                    <i class="material-icons">add_circle</i> Create Stage
                  </a>
                  <a id="" class="dropdown-item">
                    <i class="material-icons">swap_horiz</i> Change Order
                  </a>
                </div>
                <a class="dropdown-item dropdown-toggle" href=""><i class="material-icons">format_list_numbered</i> State</a>
                <div class="dropdown-menu" id="Stage-Menu">
                  <a id="create-state-sync" class="dropdown-item">
                    <i class="material-icons">add_circle</i> Create State
                  </a>
                  <a id="" class="dropdown-item">
                    <i class="material-icons">swap_horiz</i> Change Order
                  </a>
                </div>
                
                
              </div>
            </div>
          </div>
      </div>
      <hr />
    </div>
    <p>
    
    </p>
    <ul class="nav nav-pills nav-pills-warning nav-pills-icons justify-content-center" role="tablist">
      {% for stage in tevent.tournamentstage_set.all %}
        {% with stage.name|slugify as link_name %}
        <li class="nav-item">
          {% if request.GET.tab is not None %}
            {% if request.GET.tab == stage.id|stringformat:"i" %}
              <a class="nav-link active" data-toggle="tab" href="{{ '#'|add:link_name }}" role="tablist">
            {% else %}
              <a class="nav-link" data-toggle="tab" href="{{ '#'|add:link_name }}" role="tablist">
            {% endif %}
          {% else %}
            {% if forloop.counter == 1 %}
              <a class="nav-link active" data-toggle="tab" href="{{ '#'|add:link_name }}" role="tablist">
            {% else %}
              <a class="nav-link" data-toggle="tab" href="{{ '#'|add:link_name }}" role="tablist">
            {% endif %}
          {% endif %}
          
            {% if stage.tournament_stage == "GROUP_STAGE" %}
              <i class="material-icons">groups</i> {{stage.name}}
            {% elif stage.tournament_stage == "MAIN_ROUND" %}
              <i class="material-icons">shuffle</i> {{stage.name}}
            {% elif stage.tournament_stage == "KNOCKOUT_STAGE" %}
              <i class="material-icons">sports_mma</i> {{stage.name}}
            {% elif stage.tournament_stage == "PLAYOFF_STAGE" %}
              <i class="material-icons">thumb_down</i> {{stage.name}}
            {% elif stage.tournament_stage == "FINAL" %}
              <i class="material-icons">emoji_events</i> {{stage.name}}
            {% else %}
              <i class="material-icons">groups</i> {{stage.name}}
            {% endif %}
          </a>
        </li>
        {% endwith %}
      {% empty %}
        <li>No Stages defined. Please add</li>
      {% endfor %}
    </ul>
    <div class="tab-content tab-space tab-subcategories">

      {% for stage in tevent.tournamentstage_set.all %}
        {% include "beachhandball/tournamentevent/_tournament_stage_item.html" %}
      {% empty %}
      {% endfor %}

    </div>
  </div>
</div>
<ul>
{% for tst in tevent.tournamentstage_set.all %}
    <li>{{ tst.name }} {{ tst.order }}</li>
{% empty %}
    <li>No Stages defined. Please add</li>
{% endfor %}
</ul>
<h3>From View</h3>
<ul>
{% for tst in tst_view %}
    <li>{{ tst.name }}</li>
{% empty %}
    <li>Sorry, no StateTypes in this list.</li>
{% endfor %}
</ul>

{% endblock content %}


{% block javascripts %}

<script>
  $(document).ready(function() {
    //var tdata = tournament_service.getData();
    //$.when(tournament_service.getData()).done(function(result){
    //  console.debug(JSON.stringify(result));
    //  result.tstates.forEach(function(item, index){
    //    bh.addTournamentStateHTML(item, result.teams);
    //  });
    //});
    });
  
      $(function () {

          // Create tstage synchronous
          function createStageSyncModalForm() {
            $("#create-stage-sync").modalForm({
                formURL: "{% url 'structure_setup.create_tstage' pk=tevent.id %}",
                modalID: "#create-modal"
            });
          }
          createStageSyncModalForm();

          function deleteStageModalForm() {
            $(".delete-tstage").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: true});
            });
          }
          deleteStageModalForm();
          
          // Create tstate synchronous
          function createStateSyncModalForm() {
            $(".create-tstate").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url")});
            });
          }
          createStateSyncModalForm();

          function deleteStateModalForm() {
            $(".delete-tstate").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: true});
            });
          }
          deleteStateModalForm();

          function updateStateModalForm() {
            $(".update-tstate").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: false});
            });
          }
          updateStateModalForm();

          function updateTeamStatsTeamModalForm() {
            $(".update_teamstatsteam").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: false});
            });
          }
          updateTeamStatsTeamModalForm();

          function updateTTTModalForm() {
            $(".update_tttransition").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: false});
            });
          }
          updateTTTModalForm();

          function reinstantiateModalForms() {
            deleteStageModalForm();
            createStateSyncModalForm();
            deleteStateModalForm();
          }

            
          // Hide message
          $(".alert").fadeTo(2000, 500).slideUp(500, function () {
              $(".alert").slideUp(500);
          });
      });
      

  
</script>

{% endblock javascripts %}