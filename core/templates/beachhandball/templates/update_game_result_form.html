{% macro input_field(bound_field, hide_labels, extra_label_classes="", extra_control_classes="") -%}
<div class="row">
  <div class="row align-items-center">
    <div class="col-sm-7">
      <div class="form-group">
          {{ bound_field }}
          {% if bound_field.help_text %}
          <small class="form-text text-muted">{{ field.help_text }}</small>
          {% endif %}      
      </div>
    </div>
  </div>
</div>
{%- endmacro %}

<form id="update-game-result-form" method="post" action="">
  <input type="hidden" name="csrfmiddlewaretoken" value="{{csrf_token}}">

  <div class="modal-header justify-content-center">
  <div class="container">
    <div class="row">
      <div class="col-md">
        <h3><b>Team A</b></h3>
      </div>
      <div class="col-md">
      </div>
      <div class="col-md text-right">
        <h3><b>Team B</b></h3>
      </div>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="row">
      <div class="col-md text-left">
        <h4 class="modal-title"><b>{{ object.team_st_a.team.name }} vs. </b></h4>
      </div>
      <div class="col-md text-center">
        <h4> <b> vs. </b></h4>
      </div>
      <div class="col-md text-right">
        <h4><b>{{ object.team_st_b.team.name }}</b></h4>
      </div>
    </div>
    <hr>
    <div class="container">
      <div class="row">
        <div class="col-md">
          <h4>{{ game.starttime.strftime('%H:%M (%d.%m.%Y)') }}</h4>
        </div>
        <div class="col-md">
          <h4>{{ object.tournament_state }}</h4>
        </div>
        <div class="col-md">
          <h4>Court: {{ object.court }}</h4>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-md">
          <div class="row">
            <div class="col-md-3">
              <h4>Status:</h4>
            </div>
            <div class="col-md-9">
              <div class="form-group">
                {{ form['gamestate'] }}
            </div>
            </div>
          </div>
        </div>
        <div class="col-md">
          <h4>{{ object.tournament_state.tournament_event.category.abbreviation }}{{ object.id_counter }}</h4>
        </div>
        <div class="col-md">
          <h4>Scouting: {{ object.scouting_state }}</h4>
        </div>
      </div>
      <hr>
    </div>
  </div>
  </div>

  <div class="modal-body">
    <div class="container">
      <div class="row">
        <div class="col-sm">
          <div class="card">
            <div class="card-header">
              <h4><b>1. Halftime Scores</b></h4>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md align-self-center">Team A:</div>
                <div class="col-md">
                  <div class="form-group">
                      {{ input_field(form['score_team_a_halftime_1'], form.hide_labels) }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md align-self-center">Team B:</div>
                <div class="col-md">
                  <div class="form-group">
                      {{ input_field(form['score_team_b_halftime_1'], form.hide_labels) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm">
          <div class="card">
            <div class="card-header">
              <h4><b>2. Halftime Scores</b></h4>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md align-self-center">Team A:</div>
                <div class="col-md">
                  <div class="form-group">
                      {{ input_field(form['score_team_a_halftime_2'], form.hide_labels) }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md align-self-center">Team B:</div>
                <div class="col-md">
                  <div class="form-group">
                      {{ input_field(form['score_team_b_halftime_2'], form.hide_labels) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm">
          <div class="card">
            <div class="card-header">
              <h4><b>Penalty Scores</b></h4>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md align-self-center">Team A:</div>
                <div class="col-md">
                  <div class="form-group">
                      {{ input_field(form['score_team_a_penalty'], form.hide_labels) }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md align-self-center">Team B:</div>
                <div class="col-md">
                  <div class="form-group">
                      {{ input_field(form['score_team_b_penalty'], form.hide_labels) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row" hidden>
        <div class="col-md-5">
          <table id="" class="table table-striped">
            <thead>
            <tr>
                <th>#</th>
                <th>Player</th>
            </tr>
            </thead>
            
          </table>
        </div>
        <div class="col-md-2"></div>
        <div class="col-md-5">
          <table id="" class="table table-striped">
            <thead>
            <tr>
                <th>#</th>
                <th>Player</th>
            </tr>
            </thead>
            
          </table>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <input id="game_report_upload" name="file_uploaded"  type="file" accept=".xlsx,.xls" value="" >
      </div>
      <div id="WaitUpload" class="col" hidden>
        <h3>Wait uploading...</h3>
      </div>
      <div class="col">
        <button id="btn_game_report_upload" type="button" class="btn btn-secondary">Upload GameReport</button>
      </div>
      
    </div>
    <div class="row">
      <div id="ResultUpload" class="col">
        <h3 id="ResultUpload_text"></h3>
      </div>
    </div>

  </div>

  <div class="modal-footer">
    <div class="col">
      <button type="submit" class="btn btn-primary  w-100" onclick="modalShowSpinnerModal();">Update Result</button>
    </div>
    
  </div>

</form>

<script>
$(document).ready(function() {
    $("#main-content").LoadingOverlay("hide");

    $('#btn_game_report_upload').on('click', function(){
      console.log("Upload Game Report");
      $("#WaitUpload").removeAttr('hidden');
      var file = document.getElementById("game_report_upload").files[0];
      var form = new FormData();
      form.append("file_uploaded", file);
      form.append("csrfmiddlewaretoken", '{{ csrf_token }}');
  
      var settings = {
        "async": true,
        "crossDomain": true,
        "url": "http://127.0.0.1:8000/api/games/upload_report/{{ object.id }}/",
        "method": "POST",
        "processData": false,
        "contentType": false,
        "mimeType": "multipart/form-data",
        "data": form
      };
  
      $.ajax(settings).done(function (response) {
        console.log(response);
        var resp = JSON.parse(response);
        $("#WaitUpload").prop('hidden', true);
        $("#ResultUpload_text").text(resp.message);
      });
    });
  });
function modalShowSpinnerModal(){
        $("#update-game-result-form").LoadingOverlay("show");
    }
</script>